<div class="pipeline-monitor-container">
  <!-- Loading State -->
  <div class="loading-card" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading pipeline status...</p>
  </div>

  <!-- Error State -->
  <div class="error-card" *ngIf="!isLoading && errorMessage">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>Error</h2>
    <p>{{ errorMessage }}</p>
    <button routerLink="/" class="back-button">Back to Submission</button>
  </div>

  <!-- Pipeline View -->
  <div class="pipeline-card" *ngIf="!isLoading && !errorMessage && jobStatus">
    <!-- Header -->
    <div class="pipeline-header">
      <h1>Pipeline Execution</h1>
      <div class="job-info">
        <span class="job-id">Job ID: {{ jobStatus.job.id }}</span>
        <span class="status-badge" [ngClass]="getOverallStatusClass()">
          {{ jobStatus.execution.state }}
        </span>
      </div>
    </div>

    <!-- Project Info -->
    <div class="project-info">
      <div class="info-item">
        <span class="label">Framework:</span>
        <span class="value">{{ jobStatus.job.stack.framework }}</span>
      </div>
      <div class="info-item">
        <span class="label">Language:</span>
        <span class="value">{{ jobStatus.job.stack.language }}</span>
      </div>
      <div class="info-item">
        <span class="label">Build Tool:</span>
        <span class="value">{{ jobStatus.job.stack.build_tool }}</span>
      </div>
      <div class="info-item">
        <span class="label">Created:</span>
        <span class="value">{{ jobStatus.job.created_at | date:'medium' }}</span>
      </div>
    </div>

    <!-- Current Stage Indicator -->
    <div class="current-stage" *ngIf="jobStatus.execution.current_stage">
      <div class="pulse-dot"></div>
      <span>Currently running: <strong>{{ jobStatus.execution.current_stage }}</strong></span>
    </div>

    <!-- Pipeline Stages -->
    <div class="pipeline-stages">
      <div class="stage" *ngFor="let stage of stages; let i = index">
        <!-- Stage Circle -->
        <div class="stage-wrapper">
          <div [ngClass]="getStageClass(stage.status)">
            <span class="stage-icon" *ngIf="stage.status !== 'RUNNING'">
              {{ stage.icon }}
            </span>
            <div class="spinner-small" *ngIf="stage.status === 'RUNNING'"></div>
          </div>
          <div class="stage-label">{{ stage.displayName }}</div>
          <div class="stage-status-text" [ngClass]="stage.status.toLowerCase()">
            {{ stage.status }}
          </div>
        </div>

        <!-- Connector Line -->
        <div class="stage-connector" *ngIf="i < stages.length - 1">
          <div class="connector-line" 
               [class.completed]="stage.status === 'SUCCESS'"
               [class.failed]="stage.status === 'FAILED'">
          </div>
        </div>
      </div>
    </div>

    <!-- Warnings -->
    <div class="warnings-section" *ngIf="getWarnings().length > 0">
      <h3>‚ö†Ô∏è Warnings</h3>
      <div class="warning-item" *ngFor="let warning of getWarnings()">
        <strong>{{ warning[0] }}:</strong> {{ warning[1] }}
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button 
        class="download-button"
        [disabled]="jobStatus.execution.state !== 'SUCCEEDED' && jobStatus.execution.state !== 'FAILED'"
        (click)="downloadReports()">
        üì• Download Reports
      </button>
      <button routerLink="/" class="back-button">
        ‚Üê New Job
      </button>
    </div>

    <!-- Last Updated -->
    <div class="last-updated">
      Last updated: {{ jobStatus.execution.updated_at | date:'medium' }}
    </div>
  </div>
</div>